---
tags:
aliases:
---
# Description

–ó–∞–¥–∞–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —á–∞—Å—Ç–µ–π, –ø–µ—Ä–≤–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∏ —ç—Ç–æ —Å–∫–æ—Ä–µ–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã. 

# Exercises

## Exercise 1 - Developing a grpc interface

> [!NOTE]- Text
> Setup:
> 
> - Define the interface using grpc; use this library: https://github.com/grpc-
> ecosystem/grpc-spring. The documentation should provide all the information
> 
> you need.
> - Implement the project using Spring Boot with Hibernate and JPA. You can use
> the spring initializr (https://start.spring.io/) to generate your project.
> Use Gradle as build tool.
> - We recommend using an H2 in-memory database for this task.
> ------------------
> Model:
> Add reasonable fields to the entities with meaningful data types. Think of
> what information may be useful and add the specific fields.
> Think about efficiency for the data fetching side.
> - Hospital
> - Patient: A patient can be registered in multiple hospitals.
> - Stay: A patient has a stay in a hospital where he is treated
> - Bill: One or more stays generate a bill that is charged to the patient.
> ------------------
> Service:
> Define and implement at least the following operations.
> - Create, modify, and delete hospitals. Patients should not be deleted if a
> hospital is deleted.
> - Create, modify, and delete patients
> - Register a patient in a hospital
> - List all patients of a hospital
> - List all hospitals in which a patient has been registered
> - Create Bills, query them for a patient and show the outstanding balance a
> patient has with a specific hospital. Billing amount is derived from total
> stay duration multiplied by fixed monetary amount
> - List all stays of a patient, let the user query the total stay duration
> within a quarter (Q1, Q2 etc) and the associated billed amount, allow
> cancellations of stays
> ------------------
> Testing:
> Write a few simple tests that demonstrate that operations work correctly. No
> need to be exhaustive.
> ------------------

### –ü–ª–∞–Ω




## Exercise 2 - Huge data requesting

> [!NOTE]- Text
> The director of the largest hospital in the country (around 500.000 patients
per year) wants to have an overview of the average age of the patients who
visited the hospital, divided by sex and per month, for the past 10 years. He
wants to see this information immediately (<200ms). Describe in detail how
you would fulfill this request.

### –û—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –∞–Ω–ª–∏–π—Å–∫–æ–º 

Everything depends on the level of data precision required and how critical instant updates are. Aggregation can be done by month and sex or by day and sex ‚Äî even over 10 years, the dataset remains very small. For example, 500,000 patients per year over 10 years gives roughly 5 million records. Aggregating by month and sex results in only 240 rows, and even by day and sex it‚Äôs around 7,300 rows. Queries on tables of this size are effectively instantaneous. The current month can be updated incrementally without recalculating the historical data, ensuring that the report remains accurate and up-to-date.

A classic ETL approach (Extract‚ÄìTransform‚ÄìLoad) is a solid option: extract data from the transactional table, aggregate by sex and date, and load it into a target table. Historical data doesn‚Äôt need to be recalculated, and the current month can be kept separately and updated incrementally. This can be implemented using Java and JPA, with scheduled tasks to run updates automatically.

A pure SQL approach is also possible using materialized views, which store aggregates in a table-like structure. Refreshing a materialized view recalculates all historical data, which is slightly more than strictly necessary for our use case, but on the dataset size we are dealing with this is still absolutely no problem. Scheduled refreshes can ensure up-to-date results without any noticeable performance impact.

For organizations with many such reporting needs, one could consider OLAP or other analytical databases, but for just this single report, that would be overkill.

As a result, the director gets a single, fast report: historical data comes from the pre-aggregated table or materialized view, the current month from the incrementally updated table, and all queries run instantly (<200‚ÄØms). Overall, I lean toward the standard ETL solution, although the pure PostgreSQL approach is quite elegant and appealing in its own way.

## Exercise 3 - SQL optimization

> [!NOTE]- Text
> What would you do with this query?
> We have 3 tables: cats, cat_food_product, cats_cat_food_product (N x M join
> table). We want to find all cats that eat cat_food:
> SELECT * FROM cats c WHERE c.id IN ( SELECT cat_id FROM cats_cat_food_product
> WHERE cat_food_id IN ( SELECT id FROM cat_food_product ) );

### –û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º

The original query is unnecessarily complex. We're essentially just checking if a cat has _any_ record in the join table - we don't actually need to filter by specific cat food products at all.

The most efficient approach here is using EXISTS with a correlated subquery. It's perfect for this "does a relationship exist?" scenario because it stops searching as soon as it finds the first match for each cat. No need to build up a full result set or deal with duplicates like you would with JOINs.

```sql
SELECT * FROM cats c 
WHERE EXISTS (
    SELECT 1 FROM cats_cat_food_product ccp 
    WHERE ccp.cat_id = c.id
);
```

This is cleaner, faster, and exactly what we need - just checking "does this cat eat anything at all?"

## Exercise 4 - Migration

> [!NOTE]- Text
> Imagine you need to change your entity model, requiring among other changes
> changing a single element into a list, and splitting existing columns into
> multiple ones, e.g., when your address had one field that needs to be split
> into house number and street name. How would you approach this in a
> production environment? Ensure that existing data doesn‚Äôt get lost.

### –ü–µ—Ä–≤–∏—á–Ω—ã–π –ø–ª–∞–Ω

–ó–¥–µ—Å—å —è –±—É–¥—É –≤ —Å—ã—Ä–æ–º –≤–∏–¥–µ –∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –æ–ø–∏—Å—ã–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å –ø–æ–º–æ—â—å—é AI –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –æ—Ç–≤–µ—Ç. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–∏—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–∏–º, —Ç–∞–∫ —á—Ç–æ –≤–Ω–∞—á–∞–ª–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–¥–µ–ª–∏—Ç—å —Å–µ–∫—Ü–∏—é –∫—Ä–∞—Ç–∫–æ –≥–æ–≤–æ—Ä—è—â—É—é –æ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö, –∞ –¥–∞–ª—å—à–µ —É–∂–µ —Ä–∞–∑–±–∏—Ä–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ –∫–µ–π—Å—ã.

–¢–∞–∫–∂–µ —è –±—ã —É–ø–æ–º—è–Ω—É–ª —á—Ç–æ –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —è –±—É–¥—É –æ–ø–∏—Å—ã–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –Ω–æ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å —è –±—ã –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ —Ç–æ, —á—Ç–æ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ, –≤ –ø–ª–∞–Ω–µ —Ä–µ—à–µ–Ω–∏–π –∏ –ø–æ–¥—Ö–æ–¥–æ–≤, —Ç–æ—á–Ω–æ —á—Ç–æ–±—ã –Ω–µ —Ç—è–Ω—É—Ç—å –ª–∏—à–Ω–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –º–Ω–æ–∂–∏—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏. –í –ø—Ä–∏–º–µ—Ä–∞—Ö —è –æ–ø–∏—à—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —è –∫–æ–≥–¥–∞ —Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∏–ª–∏ –º–Ω–µ –±—ã–ª–æ –±—ã –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω–æ —è –≤—Å–µ–≥–¥–∞ –∫–∞–∫ –∫–æ–º–∞–Ω–¥–Ω—ã–π –∏–≥—Ä–æ–∫ –≥–æ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ —á—Ç–æ –ø—Ä–∏–Ω—è—Ç–æ. 

–í –æ–±—â–µ–º —Å–ª—É—á–∞–µ –ø—Ä–æ—Ü–µ—Å—Å —Ç–∞–∫–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã

- –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã, –≤—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- –ó–∞–ø–∏—Å—å –≤ –æ–±–∞ –º–µ—Å—Ç–∞ (dual write)
- –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
- –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞

—É –Ω–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –º–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –ø–æ—Ç–æ–º—É —á—Ç–æ —É —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è, –≤–æ–ø—Ä–æ—Å—ã –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –¥–æ–ª–∂–Ω—ã –ø–æ–¥—É–º–∞—Ç—å –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –º–∏–≥—Ä–∞—Ü–∏–∏. 

> [!NOTE]-  –§–∏–Ω–∞–ª—å–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –º–∏–≥—Ä–∞—Ü–∏–∏:
> 
> ### 1. **–¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** (2 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
> 
> - **Split column**: `address` ‚Üí `street_name` + `house_number`
> - **Single ‚Üí List**: `phone` ‚Üí `List<PhoneNumber>`
> 
> ### 2. **–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö** (2 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
> 
> - **–ù–µ–±–æ–ª—å—à–æ–π**: < 10M –∑–∞–ø–∏—Å–µ–π (–º–∏–≥—Ä–∞—Ü–∏—è –º–∏–Ω—É—Ç—ã/—á–∞—Å—ã)
> - **–ë–æ–ª—å—à–æ–π**: > 10M –∑–∞–ø–∏—Å–µ–π (–º–∏–≥—Ä–∞—Ü–∏—è —á–∞—Å—ã/–¥–Ω–∏)
> 
> ### 3. **–î–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å downtime** (2 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
> 
> - **Zero downtime**: 24/7 —Å–µ—Ä–≤–∏—Å, –Ω–µ–ª—å–∑—è –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å
> - **Maintenance window**: –µ—Å—Ç—å –æ–∫–Ω–∞ –Ω–æ—á—å—é/–≤—ã—Ö–æ–¥–Ω—ã–µ (1-4 —á–∞—Å–∞)
> 
> ### 4. **–¢–∏–ø –ë–î** (2 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
> 
> - **Relational** (PostgreSQL/MySQL) - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–∫—É—Å
> - **NoSQL** (MongoDB) - –∫—Ä–∞—Ç–∫–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–∏–π
> 
> ### 5. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏** (2 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
> 
> - **–ü—Ä–æ—Å—Ç–∞—è**: split –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—é, –ø—Ä—è–º–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
> - **–°–ª–æ–∂–Ω–∞—è**: –ø–∞—Ä—Å–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã, –≤–æ–∑–º–æ–∂–Ω—ã –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
> 
> ### 6. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å + –†–µ–ø–ª–∏–∫–∞—Ü–∏—è** (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ)
> 
> - –ù–∞–ª–∏—á–∏–µ read replicas (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É)
> - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (—Å—Ç—Ä–æ–≥–∞—è vs eventual)
> - Sharding (–º–∏–≥—Ä–∞—Ü–∏—è –ø–æ —à–∞—Ä–¥–∞–º)
> 
> ### 7. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
> 
> - –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ API/–∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å
> - –î—Ä—É–≥–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –º–æ–¥–µ–ª–∏
> - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API

–î–∞–ª—å—à–µ –≤ –∫–∞–∂–¥–æ–º —à–∞–≥–µ —è –±—É–¥—É —É–ø–æ–º—è–Ω—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π, —Ç–∞–º –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω—ã —Ä–∞–∑–≤–∏–ª–∫–∏ –Ω–∞ —ç—Ç–∏—Ö —à–∞–≥–∞—Ö.

–ò–¥–µ–º –ø–æ —ç—Ç–∞–ø–∞–º 

> [!NOTE]- **–≠—Ç–∞–ø 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
> 
> ### –ß—Ç–æ –¥–µ–ª–∞–µ–º:
> 
> 1. **–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö**
>     - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
>     - –ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö (NULL values, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã)
>     - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–µ—Å—Ç—å –ª–∏ hot spots –≤ sharded DB)
> 2. **–í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏**
>     - Expand-Migrate-Contract vs Blue-Green deployment
>     - –†–µ—à–∞–µ–º –ø—Ä–æ downtime (–º–æ–∂–µ–º –ª–∏ –ø–æ–∑–≤–æ–ª–∏—Ç—å)
> 3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
>     - –ö–æ–ø–∏—è production –¥–∞–Ω–Ω—ã—Ö (anonymized)
>     - –ü—Ä–æ–≥–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–∞ –∫–æ–ø–∏–∏
>     - –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
> 4. **Rollback –ø–ª–∞–Ω**
>     - –ö–∞–∫ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
>     - Backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
> 
> ### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
> 
> - **–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö**: SQL queries, data profiling tools
> - **–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞**: Database snapshots, AWS RDS snapshots, pg_dump/restore
> - **–ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: EXPLAIN ANALYZE, pg_stat_statements
> - **Backup**: Point-in-time recovery (PITR), automated backups
> 
> ### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ:
> 
> - –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ production?
> - –ö–∞–∫–æ–π % –¥–∞–Ω–Ω—ã—Ö "–≥—Ä—è–∑–Ω—ã–π" (–ø–æ—Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)?
> - –ú–æ–∂–µ–º –ª–∏ –º—ã –ø–æ–∑–≤–æ–ª–∏—Ç—å —Å–µ–±–µ downtime?

> [!NOTE]- **–≠—Ç–∞–ø 1: Schema evolution (DDL –∏–∑–º–µ–Ω–µ–Ω–∏—è)**
> 
> ### –ß—Ç–æ –¥–µ–ª–∞–µ–º:
> 
> –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏/—Ç–∞–±–ª–∏—Ü—ã –ë–ï–ó —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Split vs List**
> 
> **Split column:**
> 
> - –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏: `ALTER TABLE users ADD COLUMN street_name VARCHAR(255), ADD COLUMN house_number VARCHAR(50)`
> 
> **Single ‚Üí List:**
> 
> - –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É: `CREATE TABLE phone_numbers (id, user_id, phone_number, is_primary)`
> - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º array/JSON column (PostgreSQL: `ALTER TABLE users ADD COLUMN phones JSONB[]`)
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Relational vs NoSQL**
> 
> **Relational (PostgreSQL/MySQL):**
> 
> - –ò—Å–ø–æ–ª—å–∑—É–µ–º migration tools: **Flyway, Liquibase**
> - DDL –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (PostgreSQL) –∏–ª–∏ –Ω–µ—Ç (MySQL)
> - –í–∞–∂–Ω–æ: `ADD COLUMN` –æ–±—ã—á–Ω–æ –±—ã—Å—Ç—Ä–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É)
> 
> **NoSQL (MongoDB):**
> 
> - Schema-less - –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∏–Ω–∞–µ–º –ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è
> - –ù–µ—Ç —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏, –Ω–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **migrate-mongo**
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Zero downtime vs Maintenance window**
> 
> **Zero downtime:**
> 
> - –ò—Å–ø–æ–ª—å–∑—É–µ–º **online DDL** (PostgreSQL: `CONCURRENTLY`, MySQL: `ALGORITHM=INPLACE`)
> - –ò–∑–±–µ–≥–∞–µ–º —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è, rewrite table)
> - –ù–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å `DEFAULT NULL` (–±—ã—Å—Ç—Ä–æ)
> 
> **Maintenance window:**
> 
> - –ú–æ–∂–µ–º –¥–µ–ª–∞—Ç—å —Ç—è–∂–µ–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (full table rewrite)
> - –ú–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã —Å—Ä–∞–∑—É
> - –ú–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å constraints (NOT NULL, FOREIGN KEY)
> 
> ### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
> 
> - **Migration tools**: Flyway, Liquibase, Alembic (Python), Rails migrations
> - **Online DDL**: PostgreSQL native support, pt-online-schema-change (MySQL), gh-ost (GitHub tool)
> - **Monitoring**: pg_stat_activity, SHOW PROCESSLIST - —Å–º–æ—Ç—Ä–∏–º –Ω–∞ locks
> 
> ### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:
> 
> - –ù–æ–≤—ã–µ –ø–æ–ª—è –≤—Å–µ–≥–¥–∞ **nullable** –≤–Ω–∞—á–∞–ª–µ
> - –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è –ù–ï —Ç—Ä–æ–≥–∞–µ–º
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º locks –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ (–º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å production)

> [!NOTE]- **–≠—Ç–∞–ø 2: Dual-write (–∑–∞–ø–∏—Å—å –≤ –æ–±–∞ –º–µ—Å—Ç–∞)**
> 
> ### –ß—Ç–æ –¥–µ–ª–∞–µ–º:
> 
> –ò–∑–º–µ–Ω—è–µ–º –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –ø–∏—à–µ–º –¥–∞–Ω–Ω—ã–µ –ò –≤ —Å—Ç–∞—Ä—ã–µ, –ò –≤ –Ω–æ–≤—ã–µ –ø–æ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
> 
> ### –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:
> 
> - –ü—Ä–∏ –ª—é–±–æ–º UPDATE/INSERT –ø–∏—à–µ–º –≤ –æ–±–∞ –º–µ—Å—Ç–∞
> - –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º **—Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è** (fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ 4)
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Split vs List**
> 
> **Split column:**
> 
> - –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ `address` ‚Üí —Å–ø–ª–∏—Ç–∏–º –∏ –ø–∏—à–µ–º –≤ `street_name` + `house_number`
> - –¢–∞–∫–∂–µ –ø–∏—à–µ–º –≤ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ `address` (–¥–ª—è backward compatibility)
> 
> **Single ‚Üí List:**
> 
> - –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ `phone` ‚Üí —Å–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `phone_numbers` —Å —Ñ–ª–∞–≥–æ–º `is_primary=true`
> - –¢–∞–∫–∂–µ –ø–∏—à–µ–º –≤ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ `phone`
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **–ü—Ä–æ—Å—Ç–∞—è vs –°–ª–æ–∂–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è**
> 
> **–ü—Ä–æ—Å—Ç–∞—è:**
> 
> - Direct mapping, split –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—é
> - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
> 
> **–°–ª–æ–∂–Ω–∞—è:**
> 
> - –ü–∞—Ä—Å–∏–Ω–≥ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, –≤–Ω–µ—à–Ω–∏–µ API –≤—ã–∑–æ–≤—ã
> - –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** (message queue)
> - **Error handling**: —á—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å?
>     - –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É + –ø–∏—à–µ–º —Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ
>     - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º **dead letter queue** –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API**
> 
> **–ï—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã:**
> 
> - API –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: `/api/v1/` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç, `/api/v2/` –Ω–æ–≤—ã–π
> - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º **API Gateway** –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
> - GraphQL: –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è, —Å—Ç–∞—Ä—ã–µ –ø–æ–º–µ—á–∞–µ–º `@deprecated`
> 
> **–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:**
> 
> - –ú–æ–∂–µ–º —Å—Ä–∞–∑—É –º–µ–Ω—è—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
> - –ù–æ –≤–Ω—É—Ç—Ä–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ dual-write –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
> 
> ### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
> 
> - **ORM**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π dual-write —á–µ—Ä–µ–∑ entity listeners/callbacks
> - **Message Queue**: RabbitMQ, Kafka - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π
> - **API Gateway**: Kong, AWS API Gateway - –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
> - **Monitoring**: –ª–æ–≥–∏—Ä—É–µ–º –≤—Å–µ failed transformations
> 
> ### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:
> 
> - Dual-write –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–∞—Ç–æ–º–∞—Ä–Ω—ã–º** (–≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è relational DB)
> - –ï—Å–ª–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–ª–æ–∂–Ω–∞—è - –ª—É—á—à–µ **fail gracefully** (–ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ) —á–µ–º –ª–æ–º–∞—Ç—å –≤–µ—Å—å –∑–∞–ø—Ä–æ—Å
> - –ù–µ—Ç feature flags –Ω–∞ –∑–∞–ø–∏—Å—å - –ø—Ä–æ—Å—Ç–æ –≤—Å–µ–≥–¥–∞ –ø–∏—à–µ–º –≤ –æ–±–∞ –º–µ—Å—Ç–∞

> [!NOTE]- **–≠—Ç–∞–ø 3: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö**
> 
> ### –ß—Ç–æ –¥–µ–ª–∞–µ–º:
> 
> –ü–µ—Ä–µ–Ω–æ—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π –≤ –Ω–æ–≤—ã–µ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **–ù–µ–±–æ–ª—å—à–æ–π vs –ë–æ–ª—å—à–æ–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö**
> 
> **–ù–µ–±–æ–ª—å—à–æ–π –æ–±—ä–µ–º (< 10M –∑–∞–ø–∏—Å–µ–π):**
> 
> - –ü—Ä–æ—Å—Ç–æ–π UPDATE –∑–∞–ø—Ä–æ—Å, –º–æ–∂–Ω–æ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑
> - –í—ã–ø–æ–ª–Ω—è–µ–º –≤ maintenance window –∏–ª–∏ –æ–Ω–ª–∞–π–Ω (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç DB load)
> 
> **–ë–æ–ª—å—à–æ–π –æ–±—ä–µ–º (> 10M –∑–∞–ø–∏—Å–µ–π):**
> 
> - **Batch processing** - –º–∏–≥—Ä–∏—Ä—É–µ–º –ø–æ—Ä—Ü–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ 10k-100k –∑–∞–ø–∏—Å–µ–π)
> - **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º ID)
> - –ú–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å —á–∞—Å—ã/–¥–Ω–∏
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Zero downtime vs Maintenance window**
> 
> **Maintenance window:**
> 
> - –ú–æ–∂–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –æ–¥–Ω–∏–º –±–æ–ª—å—à–∏–º –±–∞—Ç—á–µ–º
> - –ú–µ–Ω—å—à–µ –±–µ—Å–ø–æ–∫–æ–∏–º—Å—è –æ –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ –ë–î
> - –ú–æ–∂–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
> 
> **Zero downtime:**
> 
> - **Throttling** - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º rate –º–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000 rows/sec)
> - –ú–∏–≥—Ä–∏—Ä—É–µ–º –≤ —Ñ–æ–Ω–µ, –Ω–µ –º–µ—à–∞—è production —Ç—Ä–∞—Ñ–∏–∫—É
> - –ú–æ–Ω–∏—Ç–æ—Ä–∏–º DB metrics (CPU, IO, replication lag)
> - –ú–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–Ω–∏, –Ω–æ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Split vs List**
> 
> **Split column:**
> 
> sql
> 
> ```sql
> -- –ü—Ä–æ—Å—Ç–æ–π UPDATE –±–∞—Ç—á–∞–º–∏
> UPDATE users SET 
>   street_name = split_part(address, ' ', 1),
>   house_number = split_part(address, ' ', 2)
> WHERE id BETWEEN ? AND ? 
>   AND street_name IS NULL
> ```
> 
> **Single ‚Üí List:**
> 
> sql
> 
> ```sql
> -- INSERT –≤ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—è
> INSERT INTO phone_numbers (user_id, phone_number, is_primary)
> SELECT id, phone, true 
> FROM users 
> WHERE id BETWEEN ? AND ?
>   AND phone IS NOT NULL
>   AND NOT EXISTS (SELECT 1 FROM phone_numbers WHERE user_id = users.id)
> ```
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **–ü—Ä–æ—Å—Ç–∞—è vs –°–ª–æ–∂–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è**
> 
> **–ü—Ä–æ—Å—Ç–∞—è:**
> 
> - SQL-based –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ –≤ –ë–î
> - –ë—ã—Å—Ç—Ä–æ, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
> 
> **–°–ª–æ–∂–Ω–∞—è (–ø–∞—Ä—Å–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –≤–Ω–µ—à–Ω–∏–µ API):**
> 
> - **Application-level –º–∏–≥—Ä–∞—Ü–∏—è** - —á–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤ –∫–æ–¥–µ, –ø–∏—à–µ–º –æ–±—Ä–∞—Ç–Ω–æ
> - **Background jobs**: Sidekiq, Celery, Spring Batch
> - **Stream processing**: Kafka Streams –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Ç–æ–∫–æ–º
> - **–ü–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö**: –ª–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–º–æ–≥–ª–∏ —Å–º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å (bad data)
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å + –†–µ–ø–ª–∏–∫–∞—Ü–∏—è**
> 
> **–ï—Å—Ç—å read replicas:**
> 
> - –ú–∏–≥—Ä–∏—Ä—É–µ–º —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ master
> - –†–µ–ø–ª–∏–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ replication lag
> - –ú–æ–∂–µ–º —á–∏—Ç–∞—Ç—å —Å —Ä–µ–ø–ª–∏–∫ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
> - –í–∞–∂–Ω–æ: —Å–ª–µ–¥–∏–º –∑–∞ **replication lag** - –Ω–µ –¥–æ–ª–∂–Ω–∞ —Å–∏–ª—å–Ω–æ –≤—ã—Ä–∞—Å—Ç–∏
> 
> **Sharded database:**
> 
> - –ú–∏–≥—Ä–∞—Ü–∏—è **–ø–æ —à–∞—Ä–¥–∞–º** –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
> - –°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ –æ–¥–Ω–æ–º —à–∞—Ä–¥–µ
> - –ü–æ—Ç–æ–º —Ä–∞—Å–∫–∞—Ç—ã–≤–∞–µ–º –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
> - –ú–æ–∂–µ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞—Ä–¥–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
> 
> **Eventual consistency –¥–æ–ø—É—Å—Ç–∏–º–∞:**
> 
> - –ú–æ–∂–µ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ–æ–Ω–µ –±–µ–∑ —Å—Ç—Ä–æ–≥–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
> - –ù–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å—Ç–∞—Ä—ã–µ/–Ω–æ–≤—ã–µ)
> 
> **–°—Ç—Ä–æ–≥–∞—è consistency:**
> 
> - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±—ã—Å—Ç—Ä–æ–π –∏–ª–∏ –≤ maintenance window
> - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º **–¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: —Å–Ω–∞—á–∞–ª–∞ –º–∏–≥—Ä–∏—Ä—É–µ–º –æ—Ñ—Ñ–ª–∞–π–Ω –¥–∞–Ω–Ω—ã–µ, –ø–æ—Ç–æ–º –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è
> 
> ### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
> 
> - **Batch processing**: Spring Batch, custom scripts —Å pagination
> - **Background jobs**: Sidekiq, Celery, AWS Lambda
> - **Monitoring**: Prometheus + Grafana –¥–ª—è –º–µ—Ç—Ä–∏–∫ (progress, rate, errors)
> - **Throttling**: pg_sleep(), rate limiters –≤ –∫–æ–¥–µ
> - **Progress tracking**: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
> - **Replication monitoring**: pg_stat_replication, SHOW SLAVE STATUS
> 
> ### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:
> 
> - **Idempotent —Å–∫—Ä–∏–ø—Ç—ã** - –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ (WHERE new_field IS NULL)
> - **Progress tracking** - –∑–Ω–∞–µ–º —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å
> - **Graceful degradation** - –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ —Å–º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∞—Å—å, –ª–æ–≥–∏—Ä—É–µ–º –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
> - **Rollback**: –º–æ–∂–µ–º –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç, dual-write –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

> [!NOTE]- **–≠—Ç–∞–ø 4: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π**
> 
> ### –ß—Ç–æ –¥–µ–ª–∞–µ–º:
> 
> –ú–µ–Ω—è–µ–º –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –Ω–∞—á–∏–Ω–∞–µ–º —á–∏—Ç–∞—Ç—å –∏–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä—ã—Ö
> 
> ### –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:
> 
> - –ò—Å–ø–æ–ª—å–∑—É–µ–º **feature flags** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
> - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π rollout (canary deployment)
> - Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –µ—Å–ª–∏ –Ω–æ–≤—ã–µ –ø—É—Å—Ç—ã–µ
> 
> ### Feature flag —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:
> 
> **–ß—Ç–µ–Ω–∏–µ —Å fallback:**
> 
> - –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è
> - –ï—Å–ª–∏ –ø—É—Å—Ç—ã–µ ‚Üí —á–∏—Ç–∞–µ–º —Å—Ç–∞—Ä—ã–µ (–¥–ª—è –∑–∞–ø–∏—Å–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã)
> - –≠—Ç–æ –∑–∞—â–∏—Ç–∞ –Ω–∞ —Å–ª—É—á–∞–π –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
> 
> **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ:**
> 
> - 1% —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Üí 10% ‚Üí 50% ‚Üí 100%
> - –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –æ—à–∏–±–∫–∏ –∏ performance –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
> - –ú–æ–∂–µ–º –æ—Ç–∫–∞—Ç–∏—Ç—å —Ñ–ª–∞–≥ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Split vs List**
> 
> **Split column:**
> 
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ `street_name` –∏ `house_number`
> - –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
> - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–∞—Ä—Å–∏–º —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ `address`
> 
> **Single ‚Üí List:**
> 
> - –ß–∏—Ç–∞–µ–º –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `phone_numbers`
> - –ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Üí fallback –Ω–∞ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ `phone`
> - –ë–µ—Ä–µ–º primary phone –∏–∑ —Å–ø–∏—Å–∫–∞
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API**
> 
> **–°—Ç–∞—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å:**
> 
> - `/api/v1/users` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (address as single field)
> - `/api/v2/users` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (street + house / phone list)
> - –í–Ω—É—Ç—Ä–∏ —á–∏—Ç–∞–µ–º –∏–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π, –Ω–æ **—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º** –æ—Ç–≤–µ—Ç –ø–æ–¥ –≤–µ—Ä—Å–∏—é API
> 
> **GraphQL:**
> 
> - –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ schema
> - –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è –ø–æ–º–µ—á–∞–µ–º `@deprecated` –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å
> - –ö–ª–∏–µ–Ω—Ç—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä—É—é—Ç –Ω–∞ –Ω–æ–≤—ã–µ –ø–æ–ª—è
> 
> **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã:**
> 
> - –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
> - –ò—Å–ø–æ–ª—å–∑—É–µ–º **adapter pattern** –∏–ª–∏ message transformation
> - –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–±—ã—Ç–∏—è –≤ Kafka –≤ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö (—Å—Ç–∞—Ä—ã–π + –Ω–æ–≤—ã–π)
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**
> 
> **–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –º–∏–≥—Ä–∞—Ü–∏–∏:**
> 
> - –ó–∞–ø—É—Å–∫–∞–µ–º **validation queries** - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
> - –ù–∞—Ö–æ–¥–∏–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è (failed migrations)
> - –†–µ—à–∞–µ–º: –¥–æ-–º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ accept–∏—Ç—å –ø–æ—Ç–µ—Ä–∏
> 
> **Eventual consistency:**
> 
> - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–æ–≤—ã–π
> - –î–æ–ø—É—Å—Ç–∏–º–æ –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
> 
> **Strict consistency —Ç—Ä–µ–±—É–µ—Ç—Å—è:**
> 
> - –í–∫–ª—é—á–∞–µ–º feature flag —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 100% –º–∏–≥—Ä–∞—Ü–∏–∏
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å–º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ
> 
> ### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
> 
> - **Feature flags**: LaunchDarkly, Unleash, custom flags –≤ Redis/DB
> - **Canary deployment**: Kubernetes canary, AWS App Mesh
> - **API versioning**: URI versioning, header-based versioning
> - **Monitoring**: error rates, latency metrics –ø–æ –≤–µ—Ä—Å–∏—è–º API
> - **A/B testing tools**: –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ rollout
> 
> ### –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:
> 
> - Feature flag —Ç–æ–ª—å–∫–æ –Ω–∞ **—á—Ç–µ–Ω–∏–µ**, –Ω–µ –Ω–∞ –∑–∞–ø–∏—Å—å (dual-write –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è)
> - –í—Å–µ–≥–¥–∞ –∏–º–µ–µ–º **fallback** –Ω–∞ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è
> - –ú–æ–Ω–∏—Ç–æ—Ä–∏–º **error rates** –ø—Ä–∏ –∫–∞–∂–¥–æ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ % —Ç—Ä–∞—Ñ–∏–∫–∞
> - –ú–æ–∂–µ–º –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ feature flag (–±–µ–∑ redeploy)
> 
> ### Validation –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º:
> 
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (–∏–ª–∏ –ø—Ä–∏–µ–º–ª–µ–º—ã–π % –∑–∞–≤–µ—Ä—à–µ–Ω)
> - Smoke tests –Ω–∞ production —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
> - –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –º–µ—Ç—Ä–∏–∫–∏ (latency, error rate) –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º –∏ –Ω–æ–≤—ã–º —á—Ç–µ–Ω–∏–µ–º

> [!NOTE]- **–≠—Ç–∞–ø 5: Cleanup (—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π)**
> 
> ### –ß—Ç–æ –¥–µ–ª–∞–µ–º:
> 
> –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è, deprecated –∫–æ–¥ –∏ feature flags –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
> 
> ### ‚ö†Ô∏è –í–∞–∂–Ω–æ: –ù–ï —Ç–æ—Ä–æ–ø–∏–º—Å—è!
> 
> - –ñ–¥–µ–º –º–∏–Ω–∏–º—É–º **2-4 –Ω–µ–¥–µ–ª–∏** –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
> - –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º –≤ production
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
> 
> ### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å cleanup:
> 
> **1. –£–¥–∞–ª–µ–Ω–∏–µ dual-write –ª–æ–≥–∏–∫–∏**
> 
> - –ü–µ—Ä–µ—Å—Ç–∞–µ–º –ø–∏—Å–∞—Ç—å –≤ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è
> - –£–±–∏—Ä–∞–µ–º –∫–æ–¥ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
> - –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å –≤ –Ω–æ–≤—ã–µ –ø–æ–ª—è
> 
> **2. –£–¥–∞–ª–µ–Ω–∏–µ feature flags**
> 
> - –£–±–∏—Ä–∞–µ–º —Ñ–ª–∞–≥–∏ –∏–∑ –∫–æ–¥–∞ (hardcode —á—Ç–µ–Ω–∏–µ –∏–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π)
> - –£–ø—Ä–æ—â–∞–µ–º –ª–æ–≥–∏–∫—É (—É–±–∏—Ä–∞–µ–º fallback –Ω–∞ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è)
> 
> **3. –£–¥–∞–ª–µ–Ω–∏–µ deprecated API endpoints**
> 
> - `/api/v1/` –º–æ–∂–µ–º –æ—Ç–∫–ª—é—á–∏—Ç—å (–µ—Å–ª–∏ –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏)
> - –£–≤–µ–¥–æ–º–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞—Ä–∞–Ω–µ–µ (deprecation notice)
> 
> **4. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π –∏–∑ –ë–î**
> 
> - –°–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã–π —à–∞–≥
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Zero downtime vs Maintenance window**
> 
> **Zero downtime:**
> 
> - –ò—Å–ø–æ–ª—å–∑—É–µ–º **online DDL**: `ALTER TABLE users DROP COLUMN address` —Å `CONCURRENTLY` (PostgreSQL)
> - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º **gh-ost, pt-online-schema-change** –¥–ª—è MySQL
> - –ú–æ–∂–µ–º —Ä–∞—Å—Ç—è–Ω—É—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–ª–∏–∑–æ–≤
> 
> **Maintenance window:**
> 
> - –ü—Ä–æ—Å—Ç–æ `DROP COLUMN` –≤ maintenance window
> - –ú–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑
> - –ë—ã—Å—Ç—Ä–µ–µ –∏ –ø—Ä–æ—â–µ
> 
> ### ‚ö° –†–∞–∑–≤–∏–ª–∫–∞: **Split vs List**
> 
> **Split column:**
> 
> - `ALTER TABLE users DROP COLUMN address`
> - –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
> 
> **Single ‚Üí List:**
> 
> - `ALTER TABLE users DROP COLUMN phone`
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –Ω–µ—Ç Foreign Keys –Ω–∞ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ
> 
> ### –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏:
> 
> **–ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –ø–æ–ª–µ–π:**
> 
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ - –Ω–∏–∫—Ç–æ –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å—Ç–∞—Ä—ã–º –ø–æ–ª—è–º
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ SQL queries –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ
> - Grep –ø–æ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ –Ω–∞ –∏–º—è —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—è
> - –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –Ω–µ—Ç legacy reports/analytics –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π
> 
> **Backup –ø–µ—Ä–µ–¥ DROP:**
> 
> - –î–µ–ª–∞–µ–º **snapshot –ë–î** –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
> - –ò–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ –∞—Ä—Ö–∏–≤ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è)
> 
> **Rollback –ø–ª–∞–Ω:**
> 
> - –ü–æ—Å–ª–µ `DROP COLUMN` –æ—Ç–∫–∞—Ç–∏—Ç—å —Å–ª–æ–∂–Ω–µ–µ
> - –ú–æ–∂–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup, –Ω–æ –ø–æ—Ç–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
> - –ü–æ—ç—Ç–æ–º—É –∂–¥–µ–º –¥–æ–ª–≥–æ –ø–µ—Ä–µ–¥ —ç—Ç–∏–º —à–∞–≥–æ–º
> 
> ### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
> 
> - **Online DDL tools**: gh-ost, pt-online-schema-change
> - **Code analysis**: grep, IDE search, static analysis tools
> - **Monitoring**: Database query logs (pg_stat_statements)
> - **Backup**: Database snapshots, point-in-time recovery
> 
> ### –ü–æ—Ä—è–¥–æ–∫ cleanup (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥):
> 
> **–†–µ–ª–∏–∑ N:** –£–±–∏—Ä–∞–µ–º dual-write (–ø–∏—à–µ–º —Ç–æ–ª—å–∫–æ –≤ –Ω–æ–≤—ã–µ –ø–æ–ª—è)
> 
> - –ñ–¥–µ–º 1-2 –Ω–µ–¥–µ–ª–∏
> 
> **–†–µ–ª–∏–∑ N+1:** –£–±–∏—Ä–∞–µ–º feature flags –∏ fallback –ª–æ–≥–∏–∫—É
> 
> - –ñ–¥–µ–º 1-2 –Ω–µ–¥–µ–ª–∏
> 
> **–†–µ–ª–∏–∑ N+2:** –£–¥–∞–ª—è–µ–º deprecated API versions
> 
> - –ñ–¥–µ–º 2-4 –Ω–µ–¥–µ–ª–∏
> 
> **–†–µ–ª–∏–∑ N+3:** `DROP COLUMN` —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π
> 
> - –§–∏–Ω–∞–ª
> 
> ### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥):
> 
> - –ï—Å–ª–∏ —É–≤–µ—Ä–µ–Ω—ã –∏ –º–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ - –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ –≤ 1-2 —Ä–µ–ª–∏–∑–∞—Ö
> - –ù–æ —Ä–∏—Å–∫ –≤—ã—à–µ
> 
> ---
> 
> ## üéâ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
> 
> ### –ò—Ç–æ–≥–æ–≤—ã–π timeline (–ø—Ä–∏–º–µ—Ä –¥–ª—è zero downtime):
> 
> - **–≠—Ç–∞–ø 0-1**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ + Schema changes (1 –¥–µ–Ω—å)
> - **–≠—Ç–∞–ø 2**: Deploy dual-write (1 –¥–µ–Ω—å)
> - **–≠—Ç–∞–ø 3**: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (—á–∞—Å—ã - –¥–Ω–∏, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—ä–µ–º–∞)
> - **–≠—Ç–∞–ø 4**: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)
> - **–≠—Ç–∞–ø 5**: Cleanup (4-8 –Ω–µ–¥–µ–ª—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è)
> 
> **–û–±—â–µ–µ –≤—Ä–µ–º—è: 2-3 –º–µ—Å—è—Ü–∞** –¥–ª—è –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —Å –±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–æ–º –¥–∞–Ω–Ω—ã—Ö.


–¢—É—Ç —ç—Ç–∞–ø—ã –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã, –Ω—É–∂–Ω–æ –¥–∏—Å—Ç–∏–ª–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –∏ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –æ–¥–Ω–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è, —á—Ç–æ–±—ã.

### –ü–ª–∞–Ω –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º

#### –ü–æ–¥—Ö–æ–¥ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

##### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

–ü—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é, —è –≤—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥–∞:

**–¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**

- –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: Split column, Merge columns, Rename
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏: Single and List conversions, One-to-One and One-to-Many conversions, Flat and Hierarchical conversions
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π: Change type, Add constraint, Enum migration
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: Normalization, Denormalization, Extract entity

**–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö:**

- –ù–µ–±–æ–ª—å—à–æ–π (< 10M –∑–∞–ø–∏—Å–µ–π) ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞ –º–∏–Ω—É—Ç—ã/—á–∞—Å—ã
- –ë–æ–ª—å—à–æ–π (> 10M –∑–∞–ø–∏—Å–µ–π) ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞ —á–∞—Å—ã/–¥–Ω–∏

**–î–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ—è:**

- Zero downtime ‚Äî —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –Ω–µ–ª—å–∑—è
- Maintenance window ‚Äî –µ—Å—Ç—å –æ–∫–Ω–∞ –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (–Ω–æ—á—å—é/–≤—ã—Ö–æ–¥–Ω—ã–µ)

**–¢–∏–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

- Relational (PostgreSQL, MySQL) ‚Äî 
- NoSQL (MongoDB –∏ —Ç–¥) ‚Äî –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–æ—â–µ

**–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:**

- –ü—Ä–æ—Å—Ç–∞—è ‚Äî split –ø–æ –ø—Ä–æ–±–µ–ª—É, –ø—Ä—è–º–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ–π –º—ë—Ä–¥–∂
- –°–ª–æ–∂–Ω–∞—è ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã, –≤–æ–∑–º–æ–∂–Ω—ã –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

**–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è:**

- –ù–∞–ª–∏—á–∏–µ read replicas ‚Äî –º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ master
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ ‚Äî —Å—Ç—Ä–æ–≥–∞—è vs eventual
- Sharding ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –ø–æ —à–∞—Ä–¥–∞–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**

- –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ API –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å
- –î—Ä—É–≥–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏
- –ù—É–∂–Ω–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API –∏–ª–∏ –∞–¥–∞–ø—Ç–µ—Ä—ã

---

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏

–ó–Ω–∞—è, —á—Ç–æ –≤—ã —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∫–ª–∏–Ω–∏–∫ —Å PostgreSQL –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –Ω–∞ Spring Boot, —è –±—ã –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–ª —Å–ª–µ–¥—É—é—â–µ–µ:

- **Zero downtime –∫—Ä–∏—Ç–∏—á–µ–Ω** ‚Äî –∫–ª–∏–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ
- **Relational DB (PostgreSQL)** ‚Äî —ç—Ç–æ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫
- **–°—Ç—Ä–æ–≥–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–∞** ‚Äî —Ç–∞–∫ –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ
- **–ï—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è** ‚Äî –≤—ã —É–ø–æ–º—è–Ω—É–ª–∏ RPO –±–ª–∏–∑–∫–æ –∫ 0, –∑–Ω–∞—á–∏—Ç —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –µ—Å—Ç—å replicas
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞** ‚Äî –Ω—É–∂–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

–ü–æ—ç—Ç–æ–º—É –¥–∞–ª—å—à–µ —è –±—É–¥—É —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑ –∑–∞–¥–∞—á–∏, –ø—Ä–æ –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –∫ –ª–∏—Å—Ç—É –∏ –ø—Ä–æ —Å–ø–ª–∏—Ç –∫–æ–ª–æ–Ω–æ–∫, —Å–∫–æ—Ä–µ–µ —Å —É—á—ë—Ç–æ–º —ç—Ç–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–±–∏—Ä–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã. 

---

#### –≠—Ç–∞–ø 0: –ê–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —è —Å–º–æ—Ç—Ä—é –Ω–∞ –¥–∞–Ω–Ω—ã–µ:

–°–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤? –ï—Å–ª–∏ –º–∏–ª–ª–∏–æ–Ω—ã, –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–π–º–µ—Ç –≤—Ä–µ–º—è. –ö–∞–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö?

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å –∫–æ–ø–∏—é –±–∞–∑—ã –∏ –æ—Ü–µ–Ω–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –Ω–µ–π, –ø–æ–ª—É—á–∏—Ç—å —Å —ç—Ç–æ–≥–æ –∫–∞–∫–∏–µ-—Ç–æ —á–∏—Å–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –º–æ–∂–Ω–æ –∏ –≤ —Ü–µ–ª–æ–º –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö.

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –∂–µ–ª–∞—Ç–µ–ª–µ–Ω zero down time –∞ –∑–∞–ø–∏—Å–µ–π —Ç–æ—á–Ω–æ –º–Ω–æ–≥–æ –ø–æ—Ç–æ–º—É —á—Ç–æ –º–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, —Ç–∞–∫ —á—Ç–æ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å –∏—Å—Ö–æ–¥—è –∏–∑ —ç—Ç–æ–≥–æ. 

---

#### –≠—Ç–∞–ø 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—Ö–µ–º—ã

–î–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–µ –ø–æ–ª—è, –Ω–æ —Å—Ç–∞—Ä—ã–µ –Ω–µ —Ç—Ä–æ–≥–∞—é —Å–æ–≤—Å–µ–º.

**–î–ª—è –∞–¥—Ä–µ—Å–æ–≤ (split column):** –°–æ–∑–¥–∞—é –¥–≤–µ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ ‚Äî street_name –∏ house_number. –û–±–µ nullable –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ.

**–î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (single ‚Üí list):** –°–æ–∑–¥–∞—é –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É phone_numbers —Å –ø–æ–ª—è–º–∏: id, patient_id, phone_number, is_primary. Foreign key –Ω–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –Ω–æ–º–µ—Ä –µ—Å–ª–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞, –±—É–¥–µ—Ç –ø—Ä–æ—â–µ —Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é. 

–ò—Å–ø–æ–ª—å–∑—É—é liquibase –∏–ª–∏ –¥—Ä—É–≥–æ–π –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –í PostgreSQL ADD COLUMN —Å DEFAULT NULL ‚Äî –±—ã—Å—Ç—Ä–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É.

–ì–ª–∞–≤–Ω–æ–µ ‚Äî —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ.

---

#### –≠—Ç–∞–ø 2: Dual-write

–ú–µ–Ω—è—é –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç–∞–∫, —á—Ç–æ–±—ã –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å—å —à–ª–∞ –≤ –æ–±–∞ –º–µ—Å—Ç–∞ ‚Äî –∏ –≤ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è, –∏ –≤ –Ω–æ–≤—ã–µ.

**–î–ª—è –∞–¥—Ä–µ—Å–æ–≤:** –ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–¥—Ä–µ—Å –ø–∞—Ü–∏–µ–Ω—Ç–∞, —è —Å–ø–ª–∏—Ç—É—é –µ–≥–æ –Ω–∞ —É–ª–∏—Ü—É –∏ –Ω–æ–º–µ—Ä –¥–æ–º–∞, –∑–∞–ø–∏—Å—ã–≤–∞—é –≤ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏. –ù–æ —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è—é –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –≤ —Å—Ç–∞—Ä–æ–º –ø–æ–ª–µ address –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

**–î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤:** –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–µ–ª–µ—Ñ–æ–Ω, —è –ø–∏—à—É –≤ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ phone (–æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–º–µ—Ä), –Ω–æ —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ phone_numbers —Å —Ñ–ª–∞–≥–æ–º is_primary.

–í–∞–∂–Ω–æ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –∞—Ç–æ–º–∞—Ä–Ω–æ ‚Äî –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ –∞–¥—Ä–µ—Å–∞ –ø—Ä–æ—Å—Ç–æ–π (split –ø–æ –ø—Ä–æ–±–µ–ª—É), –¥–µ–ª–∞—é —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. –£ –Ω–∞—Å –ø—Ä–æ—Å—Ç—ã–µ —Å–ª—É—á–∞–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ —á—Ç–æ –º–æ–∂–Ω–æ –Ω–µ –¥—É–º–∞—Ç—å –æ–± –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–¥. 

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ —á—Ç–µ–Ω–∏–µ –µ—â–µ –∏–¥–µ—Ç –∏–∑ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π. –ü—Ä–æ—Å—Ç–æ –Ω–∞—á–∏–Ω–∞—é –Ω–∞–ø–æ–ª–Ω—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

---

#### –≠—Ç–∞–ø 3: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–°–∞–º—ã–π –¥–æ–ª–≥–∏–π —ç—Ç–∞–ø ‚Äî –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–º–Ω–æ–≥–æ –∏ –µ—Å—Ç—å –æ–∫–Ω–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ç–æ –º–æ–∂–Ω–æ —Ç–æ–∂–µ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º, –Ω–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∑–¥–µ—Å—å —ç—Ç–æ –Ω–µ –Ω–∞—à —Å–ª—É—á–∞–π.

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ–¥–æ–π–¥–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –≤—ã–±–æ—Ä–∫–æ–π –±–∞—Ç—á–∞–º–∏ –∑–∞–ø–∏—Å–µ–π –∫–æ—Ç–æ—Ä—ã–µ –µ—â—ë –Ω–µ –ø—Ä–æ—à–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é. –ú—ã —ç—Ç–æ –º–æ–∂–µ–º –ø–æ–º–æ—á—å —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–µ–π –Ω–∞ null –≤ —Å–ª—É—á–∞–µ –∞–¥—Ä–µ—Å–æ–≤. –í —Å–ª—É—á–∞–µ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ –ª–∏—Å—Ç–∞ —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, –Ω—É–∂–µ–Ω –ª–∏–±–æ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å, —á—Ç–æ–±—ã –Ω–µ –ø–æ–ª—É—á–∏—Ç—å n+1 –ø—Ä–æ–±–ª–µ–º—É, –ª–∏–±–æ –º–æ–∂–Ω–æ –ø–æ–º–µ—á–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏. 

–ï—Å–ª–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –º–∏–≥—Ä–∞—Ü–∏—è –≤ —Ü–µ–ª–æ–º —Å–ª–æ–∂–Ω–∞—è, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Spring Batch, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–∞–∫–∏—Ö –∑–∞–¥–∞—á. –ù–æ –æ–Ω —á–∞—Å—Ç–æ –æ–≤–µ—Ä–∫–∏–ª–ª, —Ç–∞–∫ —á—Ç–æ –µ—Å–ª–∏ –æ–Ω –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º—É —Å—Ç–æ–∏—Ç –ø–æ–¥—É–º–∞—Ç—å, –∞ –Ω–∞–¥–æ –ª–∏.

–ó–¥–µ—Å—å –µ—â—ë –Ω—É–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å, —á—Ç–æ–±—ã –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –æ–∫–∞–∑—ã–≤–∞–ª–∞ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –Ω–∞—à–∏ –±–∞–∑—ã –∏ —Å–∏—Å—Ç–µ–º—É –∏ –µ—Å–ª–∏ —á—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å —É–º–µ–Ω—å—à–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞ —Ä–∞–∑, –≤—ã–±–∏—Ä–∞—Ç—å –≤—Ä–µ–º—è –∫–æ–≥–¥–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É –º–µ–Ω—å—à–µ.

---

#### –≠—Ç–∞–ø 4: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ

–ö–æ–≥–¥–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –º–∞—Å—Å–∞ –¥–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞, –Ω–∞—á–∏–Ω–∞—é –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ feature flag.

–ï—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ, –≤ –∏–¥–µ–∞–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –Ω–µ —Å—Ä–∞–∑—É –≤—Å–µ—Ö, –∫–∞–Ω–∞—Ä–µ–µ—á–Ω—ã–µ —Ä–µ–ª–∏–∑—ã –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—è—Ç—å-—Ç–∞–∫–∏ –æ–≤–µ—Ä–∫–∏–ª–ª –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, –Ω–æ –≤ —Ç–∞–∫–æ–π —Å—Ñ–µ—Ä–µ –∫–∞–∫ –º–µ–¥–∏—Ü–∏–Ω–∞ –∏–Ω–æ–≥–¥–∞ –ª—É—á—à–µ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ —á–µ–º –Ω–∞–æ–±–æ—Ä–æ—Ç. 

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞—é fallback: –µ—Å–ª–∏ –Ω–æ–≤—ã–µ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ (–∑–∞–ø–∏—Å—å –µ—â–µ –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞), —á–∏—Ç–∞—é –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—è. –≠—Ç–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞. –¢–∞–∫ –∂–µ –º—ã –º–æ–∂–µ–º –ø–æ–≤–µ—Å–∏—Ç—å –º–µ—Ç—Ä–∏–∫—É –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–æ–ª–ª–±–µ–∫–∞, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–æ–≥–¥–∞ –Ω–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∞ –∏ —á—Ç–æ –º—ã –Ω–µ –∑–∞–±—ã–ª–∏ –Ω–∏–∫–∞–∫–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, —Å—Ç–∞—Ä—ã–µ –∞–ø–∏, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∏ —Ç–¥. 

**–î–ª—è –∞–¥—Ä–µ—Å–æ–≤:** –ß–∏—Ç–∞—é street_name –∏ house_number. –ï—Å–ª–∏ –ø—É—Å—Ç–æ, –ø–∞—Ä—Å—é —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ address.

**–î–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤:** –ß–∏—Ç–∞—é –∏–∑ —Ç–∞–±–ª–∏—Ü—ã phone_numbers, –±–µ—Ä—É primary phone. –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è –¥–ª—è —ç—Ç–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞, —á–∏—Ç–∞—é –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—è phone.

–¢–∞–∫–∂–µ –¥—É–º–∞—é –ø—Ä–æ –¥—Ä—É–≥–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã. –ï—Å–ª–∏ –æ–Ω–∏ –æ–∂–∏–¥–∞—é—Ç –∞–¥—Ä–µ—Å –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –æ–¥–∏–Ω —Ç–µ–ª–µ—Ñ–æ–Ω, —è –ª–∏–±–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é API (v1 vs v2), –ª–∏–±–æ –¥–µ–ª–∞—é –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤. –í –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –≤–∞–∂–Ω–æ –Ω–µ —Å–ª–æ–º–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è–º–∏, —Å—Ç—Ä–∞—Ö–æ–≤—ã–º–∏ –∏ —Ç.–¥.

Feature flag –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ ‚Äî –ø—Ä–æ—Å—Ç–æ –≤—ã–∫–ª—é—á–∞—é —Ñ–ª–∞–≥, –≤—Å–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫ —Å—Ç–∞—Ä—ã–º –ø–æ–ª—è–º –±–µ–∑ —Ä–µ–¥–µ–ø–ª–æ—è.

---

#### –≠—Ç–∞–ø 5: Cleanup

–ö–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—å, –Ω–∞—á–∏–Ω–∞—é —É–±–∏—Ä–∞—Ç—å —Å—Ç–∞—Ä–æ–µ. –ù–æ –Ω–µ —Ç–æ—Ä–æ–ø–ª—é—Å—å. –í–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–±–∏–≤–∞—é –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π –≤  —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ, —É–±–∏—Ä–∞—é dual write, –∑–∞—Ç–µ–º feature flag, –∑–∞—Ç–µ–º –¥—Ä–æ–ø–∞—é –∫–æ–ª–æ–Ω–∫—É. –ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º –∫–æ–ª–æ–Ω–æ–∫ –ø—Ä–æ–≤–µ—Ä—è—é –ª–æ–≥–∏ ‚Äî –Ω–µ—Ç –ª–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Å—Ç–∞—Ä—ã–º –ø–æ–ª—è–º, –Ω–µ—Ç –ª–∏ legacy –æ—Ç—á–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç. –î–µ–ª–∞—é snapshot –±–∞–∑—ã –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π.

---

#### –ß—Ç–æ —è –≤—Å–µ–≥–¥–∞ –¥–µ—Ä–∂—É –≤ –≥–æ–ª–æ–≤–µ

–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω–∞. –í –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –Ω–µ–ª—å–∑—è –ø–æ—Ç–µ—Ä—è—Ç—å –∏–ª–∏ –∏—Å–ø–æ—Ä—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤.

Zero downtime –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. –ö–ª–∏–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ.

–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ—Å—Ç—å. –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –æ—Ç–¥–µ–ª—å–Ω–æ, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞.

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ. –°–º–æ—Ç—Ä—é –º–µ—Ç—Ä–∏–∫–∏ –ë–î, error rates, latency. –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Å—å. 

–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å. –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–ª–æ–º–∞—Ç—å—Å—è.

---

#### –ü—Ä–∏–º–µ—Ä–Ω—ã–π timeline

–ü—Ä–∏ —Ç–∞–∫–æ–º –ø–æ–¥—Ä–æ–±–Ω–æ –ø–æ–¥—Ö–æ–¥–µ –º–∏–≥—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—è—Ü–µ–≤. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ, –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö –æ–Ω–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ down time, –Ω–µ –º–µ—à–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º –∏ —Ç–¥. 
–ù–æ —ç—Ç–æ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞–ª–æ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –º–µ–Ω–µ–µ –∂–µ—Å—Ç–∫–∏–µ, –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ.

### –ë–æ–ª–µ–µ –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ 

#### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

–ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π —è –æ—Ü–µ–Ω–∏–≤–∞—é –∫–ª—é—á–µ–≤—ã–µ –≤–µ—â–∏:

- **–¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è:** split/merge –∫–æ–ª–æ–Ω–æ–∫, rename, **–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏** (single‚Üílist, one-to-many), –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
- **–û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö:** –º–∞–ª–æ (<10M) ‚Äî –±—ã—Å—Ç—Ä–æ, –º–Ω–æ–≥–æ (>10M) ‚Äî —á–∞—Å—ã/–¥–Ω–∏.
- **–î–æ–ø—É—Å—Ç–∏–º—ã–π –ø—Ä–æ—Å—Ç–æ–π:** zero downtime –∏–ª–∏ maintenance window.
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è vs NoSQL.
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:** –ø—Ä–æ—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ vs –ø–∞—Ä—Å–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã.
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è:** —Å—Ç—Ä–æ–≥–∞—è vs eventual, read replicas, —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** —Å—Ç–∞—Ä—ã–µ API/–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å; –≤–æ–∑–º–æ–∂–Ω–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –∞–¥–∞–ø—Ç–µ—Ä—ã.

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ–º–ø–∞–Ω–∏–∏

–î–ª—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ —è –≤–∑—è–ª –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, —á—Ç–æ –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ ‚Äî –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è, –Ω–∞ PostgreSQL –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö –Ω–∞ Spring Boot. –°—á–∏—Ç–∞—é, —á—Ç–æ:

- **–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö** ‚Äî –º–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π.
- **Zero downtime –∫—Ä–∏—Ç–∏—á–µ–Ω** ‚Äî –∫–ª–∏–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ.
- **–†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ (PostgreSQL)** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫.
- **–°—Ç—Ä–æ–≥–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** –≤–∞–∂–Ω–∞ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞** ‚Äî –Ω—É–∂–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.
    
–î–∞–ª—å—à–µ –ø—Ä–∏–º–µ—Ä—ã –±—É–¥—É —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å —É—á—ë—Ç–æ–º —ç—Ç–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—è –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.

#### –≠—Ç–∞–ø 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—Ö–µ–º—ã

–î–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–µ –ø–æ–ª—è, –Ω–µ —Ç—Ä–æ–≥–∞—è —Å—Ç–∞—Ä—ã–µ, —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∞ —Ä–∞–±–æ—Ç–∞—Ç—å:

- **–ê–¥—Ä–µ—Å:** –ø—Ä–æ—Å—Ç–æ–π —Å–ª—É—á–∞–π ‚Äî –¥–æ–±–∞–≤–ª—è—é –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç—É –∂–µ —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —É–ª–∏—Ü—ã –∏ –Ω–æ–º–µ—Ä–∞ –¥–æ–º–∞.
    
- **–¢–µ–ª–µ—Ñ–æ–Ω—ã:** –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π —Å–ª—É—á–∞–π ‚Äî —Å–æ–∑–¥–∞—é –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Å–ø–∏—Å–∫–∞ –Ω–æ–º–µ—Ä–æ–≤, —Å–≤—è–∑—ã–≤–∞—é –æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º —Å –ø–∞—Ü–∏–µ–Ω—Ç–æ–º. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –Ω–æ–º–µ—Ä –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ —ç—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ.

–¢–∞–∫ –º—ã –≥–æ—Ç–æ–≤–∏–º —Å–∏—Å—Ç–µ–º—É –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞.

#### –≠—Ç–∞–ø 2: Dual-write

–û–±–Ω–æ–≤–ª—è—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–∏—Å–∞–ª–∏—Å—å –∏ –≤ —Å—Ç–∞—Ä—ã–µ, –∏ –≤ –Ω–æ–≤—ã–µ –ø–æ–ª—è:

- **–ê–¥—Ä–µ—Å:** —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –≤ —Å—Ç–∞—Ä–æ–º –ø–æ–ª–µ, –Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏ ‚Äî –≤ –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö.
- **–¢–µ–ª–µ—Ñ–æ–Ω—ã:** –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–º–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∏ –≤ —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ, –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ primary –≤ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ.

–í–∞–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∑–∞–ø–∏—Å—å –∞—Ç–æ–º–∞—Ä–Ω–æ, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –∏ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–º–∏. –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ —á—Ç–µ–Ω–∏–µ –≤—Å—ë –µ—â—ë –∏–¥—ë—Ç –∏–∑ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª–µ–π, –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

#### –≠—Ç–∞–ø 3: –ú–∏–≥—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–≠—Ç–æ —Å–∞–º—ã–π –¥–æ–ª–≥–∏–π —ç—Ç–∞–ø ‚Äî –ø–µ—Ä–µ–Ω–æ—Å –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –≤ –Ω–æ–≤—ã–µ –ø–æ–ª—è –∏ —Ç–∞–±–ª–∏—Ü—ã. –†–∞–±–æ—Ç–∞ –≤–µ–¥—ë—Ç—Å—è –±–∞—Ç—á–∞–º–∏, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–∏—Å—Ç–µ–º—É, –ø—Ä–æ–≤–µ—Ä—è—è, –∫–∞–∫–∏–µ –∑–∞–ø–∏—Å–∏ –µ—â—ë –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–æ –ø—É—Å—Ç—ã–º –Ω–æ–≤—ã–º –ø–æ–ª—è–º. –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —à–µ–¥—É–ª–µ—Ä–∞ Spring –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞—Ç—á–µ–π, –Ω–æ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Spring Batch.

- **–ê–¥—Ä–µ—Å–∞:** –ø–µ—Ä–µ–Ω–æ—Å–∏–º –¥–∞–Ω–Ω—ã–µ –≤ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
- **–¢–µ–ª–µ—Ñ–æ–Ω—ã:** –ø–µ—Ä–µ–Ω–æ—Å–∏–º –≤ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É; –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–º–µ—Ä –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—è –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ primary. –ü—Ä–∏ —ç—Ç–æ–º –≤–∞–∂–Ω–æ –∏–∑–±–µ–≥–∞—Ç—å n+1 –ø—Ä–æ–±–ª–µ–º, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–ª–∞–≥–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    
–°–ª–µ–¥–∏–º –∑–∞ –Ω–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ –±–∞–∑—É –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π –∏–ª–∏ –≤—ã–±–∏—Ä–∞–µ–º –≤—Ä–µ–º—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é.

#### –≠—Ç–∞–ø 4: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ

–ö–æ–≥–¥–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –º–∞—Å—Å–∞ –¥–∞–Ω–Ω—ã—Ö –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞, –Ω–∞—á–∏–Ω–∞—é –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ feature flag. –ò–¥–µ–∞–ª—å–Ω–æ ‚Äî –¥–µ–ª–∞—Ç—å —ç—Ç–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä –∫–∞–Ω–∞—Ä–µ–µ—á–Ω—ã–º–∏ —Ä–µ–ª–∏–∑–∞–º–∏, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫.

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞—é fallback: –µ—Å–ª–∏ –Ω–æ–≤—ã–µ –ø–æ–ª—è –µ—â—ë –ø—É—Å—Ç—ã–µ, —á–∏—Ç–∞—é –∏–∑ —Å—Ç–∞—Ä—ã—Ö. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è fallback, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–æ–≥–¥–∞ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã.

- **–ê–¥—Ä–µ—Å–∞:** —á–∏—Ç–∞–µ–º –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏, –ø—Ä–∏ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ.
- **–¢–µ–ª–µ—Ñ–æ–Ω—ã:** —á–∏—Ç–∞–µ–º –∏–∑ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã, –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–º–µ—Ä –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ primary; –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç, —á–∏—Ç–∞–µ–º —Å—Ç–∞—Ä–æ–µ –ø–æ–ª–µ.

–î–ª—è –¥—Ä—É–≥–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API –∏–ª–∏ –∞–¥–∞–ø—Ç–µ—Ä—ã. Feature flag –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Å—Ç–∞—Ä—ã–º –ø–æ–ª—è–º –±–µ–∑ –¥–µ–ø–ª–æ—è.

#### –≠—Ç–∞–ø 5: Cleanup

–ü–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–µ–¥–µ–ª—å —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞—á–∏–Ω–∞—é –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–±–∏—Ä–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã. –û–±—ã—á–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫–ª—é—á–∞—é dual-write, –∑–∞—Ç–µ–º feature flag, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º —É–¥–∞–ª—è—é –∫–æ–ª–æ–Ω–∫–∏. –ü–µ—Ä–µ–¥ —ç—Ç–∏–º –ø—Ä–æ–≤–µ—Ä—è—é –ª–æ–≥–∏ –∏ legacy –æ—Ç—á—ë—Ç—ã, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –∏ –¥–µ–ª–∞—é snapshot –±–∞–∑—ã –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π.

#### –ò—Ç–æ–≥–∏ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã

–Ø —Å—á–∏—Ç–∞—é, —á—Ç–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –æ—Ç –Ω–µ–¥–µ–ª—å –¥–æ –º–µ—Å—è—Ü–µ–≤, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∏ –±–µ–∑ –ø—Ä–æ—Å—Ç–æ–µ–≤.

–ù–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ —è –¥–µ—Ä–∂—É –≤ –≥–æ–ª–æ–≤–µ –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã: –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, zero downtime, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ—Å—Ç—å —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞—Ç–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ –∏ –Ω–∞–≥—Ä—É–∑–∫–∏, –∞ —Ç–∞–∫–∂–µ –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, —á—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å —Ä–∞–±–æ—Ç—É –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. 

–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–º —Ü–∏–∫–ª–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –æ—Ç unit –¥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ production. –≠—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø–æ–º–æ–≥–∞—é—Ç –º–Ω–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.

### –û—Ç–≤–µ—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
#### Key Strategy Factors
Before migration, I evaluate the key things:

- **Type of change:** split/merge columns, rename, cardinality changes, normalization or changes to types/constraints.
- **Data volume:** small (<10M) ‚Äî minutes/hours, large (>10M) ‚Äî hours/days.
- **Acceptable downtime:** zero downtime or maintenance window.
- **Database:** relational vs NoSQL.
- **Transformation complexity:** simple operations vs parsing, validation, external calls.
- **Consistency and replication:** strict vs eventual, read replicas, sharding.
- **Backward compatibility:** old APIs/microservices must work; possibly versioning or adapters.
#### Company Context
For relevant examples, I took from public sources that your system is medical, on PostgreSQL and Spring Boot microservices. I assume that:

- **Large data volume** ‚Äî many patients, historical records.
- **Zero downtime is critical** ‚Äî clinics operate 24/7.
- **Relational database (PostgreSQL)** ‚Äî main stack.
- **Strict consistency** is important for medical data.
- **Microservices depend on each other** ‚Äî backward compatibility is needed.

Going forward, I'll consider examples with these constraints in mind, without revealing all possible options.
#### Stage 1: Schema Expansion
I add new fields without touching the old ones, so the system continues to work:

- **Address:** simple case ‚Äî I add new columns to the same table for street and house number.
- **Phones:** more complex case ‚Äî I create a separate table for the list of numbers, link it one-to-many with the patient. If necessary, you can add uniqueness on the number to support idempotency, if it matches the business logic.

This way we prepare the system for changes while keeping old data and service availability.
#### Stage 2: Dual-write
I update the application so that new data is written to both old and new fields:

- **Address:** we save the full address in the old field, split parts ‚Äî in new columns.
- **Phones:** the primary number is added to the old field, marked as primary in the new table.

It's important to make the write atomic, so new and old data remain consistent. At this stage, reads still come from old fields, new columns are just being populated with new data.
#### Stage 3: Historical Data Migration
This is the longest stage ‚Äî transferring all existing records to new fields and tables. Work is done in batches to avoid overloading the system, checking which records haven't been migrated yet, for example by empty new fields. In most cases, a simple Spring scheduler is enough for batch processing, but for complex transformations you can use the specialized Spring Batch framework.

- **Addresses:** we transfer data to new columns, keeping the old field for backward compatibility.
- **Phones:** we transfer to the new table; the primary number from the old field is marked as primary. It's important to avoid n+1 problems here, you can use temporary flags for processing or custom query for getting unprocessed records.

We monitor the database load and if necessary reduce batch size or choose times with minimal activity.
#### Stage 4: Gradual Read Switch
When the bulk of data is migrated, I start switching reads through a feature flag. Ideally ‚Äî do this gradually, for example with canary releases, to reduce risk.

I definitely make a fallback: if new fields are still empty, I read from old ones. You can also track fallback usage metrics to understand when all data and integrations are fully migrated.

- **Addresses:** we read new columns, with empty values we use the old field.
- **Phones:** we read from the new table, the primary number is marked as primary; if there's no record, we read the old field.

For other microservices that depend on the old structure, you can use API versioning or adapters. The feature flag allows instant rollback to old fields without deployment.
#### Stage 5: Cleanup
After several weeks of stable operation, I start gradually removing old fields and mechanisms. Usually I first disable dual-write, then the feature flag, and only then delete columns. Before this, I check logs and legacy reports to make sure old fields are no longer used, and make a database snapshot just in case.
#### Summary and Principles
I believe that careful and safe migration can take from weeks to months, but the system remains fully functional and without downtime.

At each stage, I keep in mind the key principles: data consistency, zero downtime, gradual approach with rollback capability, monitoring metrics and load, as well as backward compatibility to avoid breaking other services.

Obviously, each stage is accompanied by a full testing cycle ‚Äî from unit to integration tests and production validation. These principles help me conduct migration predictably and safely.